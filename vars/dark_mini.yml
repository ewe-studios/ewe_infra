---
vps_image_version: 0.0.2

device:
  iface: "enp3s0f0"

network: "darkmini"

peers: [ "darkmini","slave1", "slave2" ]

peers_meta:
  peers_vms: "{{ dict(peers | zip(peers | map('extract', networks) | map(attribute='vms'))) }}"
  peers_wg: "{{ dict(peers | zip(peers | map('extract', networks) | map(attribute='host') | flatten | map(attribute='wg'))) }}"
  peers_hosts: "{{ dict(peers | zip(peers | map('extract', networks) | map(attribute='host') | flatten )) }}"

caddy2:
  serverIP: "{{ networks[network].host.ip }}"

wg:
  name: "metal0"
  interface: "enp3s0f0"
  cidr: "{{ networks[network].host.wg.cidr }}"
  private_key: "{{ secrets[network].host.private_key }}"
  public_key: "{{ secrets[network].host.public_key }}"

host:
  cidr: "{{ networks[network].host.cidr }}"
  serverIP: "{{ networks[network].host.ip }}"

vms:
  - vm_name: "master1"
    vm_cpu: 2
    vm_memory: 2G
    vm_disk: 3GB
    vm_image: "localhost:5443/machine_image:{{ vps_image_version }}"
    owner_tag: "machine"
    owner_name: "{{ ansible_hostname }}"
    wg: "{{ wg }}"
    peers: "{{ peers_meta }}"
    network: "{{ host }}"
    labels:
      - name: "group"
        value: "controller"
      - name: "desc"
        value: "controller vm for infrastructure in master1"
    annotations:
      - name: "group"
        value: "controller"

